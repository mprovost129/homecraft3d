{% extends 'base.html' %}
{% block title %}Conversation | 3D Print Marketplace{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="card-title mb-3">Conversation</h1>
      <div class="mb-3">
        <a href="{% url 'messaging:inbox' %}" class="btn btn-outline-secondary">Back to Inbox</a>
      </div>
      <div class="card mb-3 border-0 bg-light">
        <div class="card-body" style="max-height:400px;overflow-y:auto;">
          {% for msg in messages %}
            <div class="mb-2 {% if msg.sender == request.user %}text-end{% endif %}">
              <div class="d-inline-block p-2 rounded-3 shadow-sm {% if msg.sender == request.user %}bg-primary text-white{% else %}bg-white border{% endif %}">
                <strong>{{ msg.sender.username }}</strong><br>
                {{ msg.body|linebreaksbr }}
                <div class="small text-muted">{{ msg.sent_at|date:"Y-m-d H:i" }}</div>
              </div>
            </div>
          {% empty %}
            <div class="alert alert-info mb-0">No messages yet.</div>
          {% endfor %}
        </div>
      </div>
      <form method="post" class="mt-3">
        {% csrf_token %}
        <div class="mb-2">{{ form.body }}</div>
        <div class="mb-2">{{ form.captcha }}</div>
        <button type="submit" class="btn btn-primary">Send</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% extends 'base.html' %}
{% block title %}Seller Dashboard | {{ STORE_NAME }}{% endblock %}
{% block content %}
<div class="container mt-4">
	{% if request.user.is_superuser or request.user.is_owner %}
		<div class="mb-3">
			<a href="/storefront/settings/" class="btn btn-warning">Storefront Settings</a>
			<span class="text-muted ms-2">(Owner/Admin only: control recommendations and featured logic)</span>
		</div>
	{% endif %}
	<div class="mb-3">
		<a href="{% url 'wishlist' %}" class="btn btn-outline-primary">View Wishlist</a>
	</div>
	<h1>Seller Dashboard</h1>
	<hr>
	<div class="mb-3">
		<strong>Seller Rating:</strong>
		{% with ratings=request.user.seller.ratings.all %}
			{% if ratings %}
				<span class="text-warning">&#9733;</span>
				{{ ratings|average:'score'|floatformat:1 }} / 5 ({{ ratings|length }} review{{ ratings|length|pluralize }})
			{% else %}
				<span class="text-muted">No ratings yet.</span>
			{% endif %}
		{% endwith %}
	</div>
	<div class="mb-3">
		<strong>Stripe Status:</strong>
		{% if stripe_connected %}
			<span class="badge bg-success">Connected</span>
		{% else %}
			<span class="badge bg-warning text-dark">Not Connected</span>
			<form method="post" style="display:inline;">
				{% csrf_token %}
				<button type="submit" name="connect_stripe" class="btn btn-sm btn-outline-primary ms-2">Connect Stripe</button>
			</form>
		{% endif %}
	</div>
	<div class="row">
		<div class="col-12 mb-4">
			<h3>Product Analytics</h3>
			<a href="{% url 'product_analytics' %}" class="btn btn-outline-info btn-sm mb-2">View Detailed Analytics</a>
			<table class="table table-sm table-bordered w-auto">
				<thead>
					<tr>
						<th>Product</th>
						<th>Views</th>
						<th>Purchases</th>
					</tr>
				</thead>
				<tbody>
					{% for product in products|slice:':5' %}
					<tr>
						<td>{{ product.name }}</td>
						<td>{{ product.view_count }}</td>
						<td>{{ product.purchase_count }}</td>
					</tr>
					{% empty %}
					<tr><td colspan="3">No products yet.</td></tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		<div class="col-md-6">
			<h3>Your Products</h3>
			<a href="#" class="btn btn-sm btn-success mb-2">Upload New Product</a>
			<ul class="list-group mb-3">
				{% for product in products %}
					<li class="list-group-item d-flex justify-content-between align-items-center">
						{{ product.name }}
						<span>${{ product.price }}</span>
					</li>
				{% empty %}
					<li class="list-group-item">No products yet.</li>
				{% endfor %}
			</ul>
			<h4 class="mt-4">Top Products</h4>
			<div class="container mt-4">
				<div class="mb-3">
					<a href="{% url 'wishlist' %}" class="btn btn-outline-primary">View Wishlist</a>
				</div>
				<div class="card shadow-sm mb-4">
					<div class="card-body">
						<h1 class="card-title mb-3">Seller Dashboard</h1>
						<div class="mb-3">
							<strong>Stripe Status:</strong>
							{% if stripe_connected %}
								<span class="badge bg-success">Connected</span>
							{% else %}
								<span class="badge bg-warning text-dark">Not Connected</span>
								<form method="post" style="display:inline;">
									{% csrf_token %}
									<button type="submit" name="connect_stripe" class="btn btn-sm btn-outline-primary ms-2">Connect Stripe</button>
								</form>
							{% endif %}
						</div>
						<h3 class="mt-4">Product Analytics</h3>
						<a href="{% url 'product_analytics' %}" class="btn btn-outline-info btn-sm mb-2">View Detailed Analytics</a>
						<table class="table table-sm table-bordered w-auto align-middle">
							<thead class="table-light">
								<tr>
									<th>Product</th>
									<th>Views</th>
									<th>Purchases</th>
								</tr>
							</thead>
							<tbody>
								{% for product in products|slice:':5' %}
								<tr>
									<td>{{ product.name }}</td>
									<td>{{ product.view_count }}</td>
									<td>{{ product.purchase_count }}</td>
								</tr>
								{% empty %}
								<tr><td colspan="3">No products found.</td></tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
						plugins: {
							legend: { display: false },
							title: { display: false }
						},
						scales: {
							y: { beginAtZero: true }
						}
					}
				});
			</script>
			<h4 class="mt-4">Recent Orders</h4>
			<ul class="list-group">
				{% for order in orders|slice:":5" %}
					<li class="list-group-item">
						{{ order.order.created_at|date:"Y-m-d" }} - {{ order.product.name }} x{{ order.quantity }}
					</li>
				{% empty %}
					<li class="list-group-item">No orders yet.</li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div class="mt-4">
		<h3>Media Gallery</h3>
		<p class="text-muted">(Coming soon: manage your product images and files here.)</p>
	</div>
</div>
{% endblock %}

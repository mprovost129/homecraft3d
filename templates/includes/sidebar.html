{# Dedicated sidebar with category separation and admin links #}
<div class="sidebar p-3 bg-light h-100">

  <h6 class="text-uppercase">Quick Filters</h6>
  <ul class="nav flex-column mb-3">
    <li class="nav-item">
      <a class="nav-link d-flex align-items-center" href="/products/?free=1">
        <i class="bi bi-gift me-2 text-success"></i> Free Models
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link d-flex align-items-center" href="/products/?paid=1">
        <i class="bi bi-currency-dollar me-2 text-warning"></i> Paid Models
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link d-flex align-items-center" href="/products/?digital=1">
        <i class="bi bi-cloud-arrow-down me-2 text-info"></i> Digital Downloads
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link d-flex align-items-center" href="/products/?physical=1">
        <i class="bi bi-box-seam me-2 text-primary"></i> Physical Objects
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link d-flex align-items-center" href="/products/?featured=1">
        <i class="bi bi-star-fill me-2 text-warning"></i> Featured
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link d-flex align-items-center" href="/products/?sort=new">
        <i class="bi bi-clock-history me-2 text-secondary"></i> New Arrivals
      </a>
    </li>
  </ul>

  <h6 class="text-uppercase">Categories</h6>

  <h6 class="mt-3">Material Categories</h6>
  <ul class="nav flex-column mb-3">
    {% for category in material_categories %}
      {% if not category.parent %}
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center"
             data-bs-toggle="collapse"
             href="#mat-cat-{{ category.id }}"
             role="button"
             aria-expanded="false"
             aria-controls="mat-cat-{{ category.id }}">
            <span class="me-2">
              {% if category.image %}
                <img src="{{ category.image.url }}" alt="{{ category.name }}"
                     style="height:20px;width:20px;object-fit:cover;">
              {% else %}
                <i class="bi bi-box"></i>
              {% endif %}
            </span>

            <span>{{ category.name }}</span>

            <span class="ms-auto">
              <i class="bi bi-chevron-down"></i>
            </span>
          </a>

          <ul class="collapse ms-3 nav flex-column" id="mat-cat-{{ category.id }}">
            {% for sub in category.subcategories.all %}
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center {% if sub.id|stringformat:'s' == subcategory_id %}active fw-bold text-primary{% endif %}"
                   href="?subcategory={{ sub.id }}">
                  <i class="bi bi-dot me-1"></i>{{ sub.name }}
                </a>
              </li>
            {% empty %}
              <li class="nav-item text-muted small ms-2">No subcategories</li>
            {% endfor %}
          </ul>
        </li>
      {% endif %}
    {% empty %}
      <li class="nav-item text-muted">No material categories</li>
    {% endfor %}
  </ul>

  <h6>Digital Download Categories</h6>
  <ul class="nav flex-column mb-3">
    {% for category in digital_categories %}
      {% if not category.parent %}
        <li class="nav-item">
          <a class="nav-link d-flex align-items-center"
             data-bs-toggle="collapse"
             href="#dig-cat-{{ category.id }}"
             role="button"
             aria-expanded="false"
             aria-controls="dig-cat-{{ category.id }}">
            <span class="me-2">
              {% if category.image %}
                <img src="{{ category.image.url }}" alt="{{ category.name }}"
                     style="height:20px;width:20px;object-fit:cover;">
              {% else %}
                <i class="bi bi-cloud-arrow-down"></i>
              {% endif %}
            </span>

            <span>{{ category.name }}</span>

            <span class="ms-auto">
              <i class="bi bi-chevron-down"></i>
            </span>
          </a>

          <ul class="collapse ms-3 nav flex-column" id="dig-cat-{{ category.id }}">
            {% for sub in category.subcategories.all %}
              <li class="nav-item">
                <a class="nav-link d-flex align-items-center {% if sub.id|stringformat:'s' == subcategory_id %}active fw-bold text-primary{% endif %}"
                   href="?subcategory={{ sub.id }}">
                  <i class="bi bi-dot me-1"></i>{{ sub.name }}
                </a>
              </li>
            {% empty %}
              <li class="nav-item text-muted small ms-2">No subcategories</li>
            {% endfor %}
          </ul>
        </li>
      {% endif %}
    {% empty %}
      <li class="nav-item text-muted">No digital categories</li>
    {% endfor %}
  </ul>

  {% if user.is_authenticated and user.is_owner or user.is_authenticated and user.is_staff %}
    <h6 class="text-uppercase mt-4">Admin</h6>
    <ul class="nav flex-column">
      <li class="nav-item"><a href="{% url 'accounts:owner_dashboard' %}" class="nav-link">Dashboard Home</a></li>
      <li class="nav-item"><a href="{% url 'category_list' %}" class="nav-link">Manage Categories</a></li>
      <li class="nav-item"><a href="/admin/" class="nav-link">Django Admin</a></li>
    </ul>
  {% endif %}

</div>

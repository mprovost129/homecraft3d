{% extends 'base.html' %}
{% block title %}Order History | 3D Print Marketplace{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="card-title mb-3">Order History</h1>
      {% if orders %}
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Order ID</th>
              <th>Date</th>
              <th>Status</th>
              <th>Items</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr>
              <td>{{ order.id }}</td>
              <td>{{ order.created_at|date:'Y-m-d H:i' }}</td>
              <td>{{ order.status }}</td>
              <td>
                <ul class="mb-0 ps-3">
                  {% for item in order.lineitem_set.all %}
                    <li>
                      {{ item.product.name }} (x{{ item.quantity }})
                      <br>
                      <small>Seller: {{ item.product.seller.user.username }}
                        {% if not item.seller_has_rating %}
                          <a href="{% url 'rate_seller' item.product.seller.id order.id %}" class="btn btn-link btn-sm p-0 ms-2">Rate Seller</a>
                        {% else %}
                          <span class="text-success ms-2">Rated</span>
                        {% endif %}
                      </small>
                    </li>
                  {% endfor %}
                </ul>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="alert alert-info mb-0">You have no orders yet.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
